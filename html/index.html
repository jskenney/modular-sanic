<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport"  content="width=device-width, initial-scale=1">

  <link rel="icon"       href="/favicon.ico">
  <link rel="stylesheet" href="/uikit/uikit.min.css">

  <script src="/uikit/uikit.min.js"></script>

  <title>Start Page</title>

</head>
<body class="uk-flex uk-flex-center uk-flex-middle uk-background-muted " data-uk-height-viewport>
<br><br>
<pre><h3>API Documentation</h3><a href="/docs/swagger">/docs/swagger</a>              - Automatically Generated API Documentation (Swagger)
<a href="/docs">/docs</a>                      - Automatically Generated API Documentation (ReDocs)<h4>Authentication Endpoints (accessible from within a session capable browser)</h4><a href="/auth/logon/logon.html">/auth/logon/logon.html</a>     - PAM Authentication                 (will redirect if logged on)
<a href="/auth/logon/challenge.html">/auth/logon/challenge.html</a> - Email Challenge Authentication     (will redirect if logged on)
<a href="/auth/logon/apikey.html">/auth/logon/apikey.html</a>    - API Key Authentication             (will redirect if logged on)
<a href="/auth/logon/apifile.html">/auth/logon/apifile.html</a>   - API Key File Upload Authentication (will redirect if logged on)

<a href="/auth/logon/logoff.html">/auth/logon/logoff.html</a>    - Logoff

<a href="/auth/logon/su.html">/auth/logon/su.html</a>        - Switch User - Requires Admin
<a href="/auth/logon/return.html">/auth/logon/return.html</a>    - Switch User - Return to original account

<a href="/auth/key">/auth/key</a>                  - Show User Info
<a href="/auth/info">/auth/info</a>                 - Show User and Site Info (used on auth websites)
<a href="/auth/rekey">/auth/rekey</a>                - Reset API Key

<a href="/auth/redirect_if_logged_on">/auth/redirect_if_logged_on</a>  - Provide redirect URL if logged on to logged on page
<a href="/auth/redirect_if_logged_off">/auth/redirect_if_logged_off</a> - Provide redirect URL if logged off to logged off page
<h4>API Key (Provided for debugging and inserted automatically into most examples below)</h4>
<span id=akey>Pending server response...  Note: API keys are unavailable if MySQL database is not used.</span>
<h4>Logged on User Information (Provided for debugging)</h4>
<span id=info>Pending server response...</span>
<h3>Endpoints below require an API key, key is ignored if a valid web session is found.</h3><h4>Access Endpoints</h4>/auth/&lt;apikey&gt;/access/list/&lt;user&gt;                    - Lists Accesses (requires admin for other users)
/auth/&lt;apikey&gt;/access/add/&lt;user&gt;/&lt;access&gt;/&lt;value&gt;    - Add/Modify Access (requires admin)
/auth/&lt;apikey&gt;/access/remove/&lt;user&gt;/&lt;access&gt;/&lt;value&gt; - Remove Access (requires admin)
</pre>
<br><br><br>
<script>

fetch('/auth/key')
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.json();
  })
  .then(result => {
    document.getElementById('info').textContent = JSON.stringify(result, null, 2);
    console.log(result);
    if (result.data.apikey) {
      document.getElementById('akey').textContent = result.data.apikey;
      const links = document.querySelectorAll('a[href]');
      links.forEach(link => {
        let href = link.getAttribute('href');
        const newHref = href.replace('/aaaa/', '/' + result.data.apikey + '/');
        if (newHref !== href) {
          link.setAttribute('href', newHref);
          link.textContent = link.textContent.replace('<apikey>', result.data.apikey);
        }
      });
    }
  })
  .catch(error => {
    console.error('Error fetching API key:', error);
  });

</script>
